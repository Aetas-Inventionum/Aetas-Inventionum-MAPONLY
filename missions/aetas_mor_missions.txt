ai_fez_branch_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = FEZ
			was_tag = FEZ
		}
	}

	fez_viziers = {
		icon = mission_gra4
		position = 1
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = fez_wat.tt
				has_reform = wattasid_vizier_reform
			}
		} 

		effect = { add_adm_power = 25 } 
	}

	fez_tensions = {
		icon = mission_eliminate_pretenders
		position = 2
		required_missions = { fez_viziers } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = fez_wat2.tt
				OR = {
					has_country_flag = fez_attempt_flag
					has_country_flag = fez_nothing_flag
					has_country_flag = fez_accept_wattasids_flag
				}
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = fez_stab_mod #missing loc
				duration = 18250
			}
		} 
	}

	fez_stab = {
		icon = mam_harness_spice_trade
		position = 3
		required_missions = { fez_tensions } 
		provinces_to_highlight = {  } 

		trigger = {  
			stability = 3
			NOT = { has_reform = wattasid_vizier_reform } 
		} 

		effect = {  
			add_country_modifier = { 
				name = fez_stab_mod2
				duration = -1
			}
		} 
	}

	fez_madrasas = {
		icon = mission_mustansiriya_madrasah
		position = 4
		provinces_to_highlight = {  
			owned_by = ROOT 
			has_tax_building_trigger = no 
		} 

		trigger = {  
			num_of_owned_provinces_with = { 
				value = 10 
				has_tax_building_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = fez_madrasa_mod
				duration = 18250
			}
		} 
	}

	fez_seat = {
		icon = mission_conquer_algiers
		position = 5
		required_missions = { fez_madrasas } 
		provinces_to_highlight = {  
			province_id = 343
			NOT = {
				AND = {
					is_capital = yes 
					num_of_times_improved = 10
					has_tax_building_trigger = yes 
					has_trade_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			343 = {
				is_capital = yes 
				num_of_times_improved = 10
				has_tax_building_trigger = yes 
				has_trade_building_trigger = yes 
			}
		} 

		effect = {  
			343 = { 
				add_province_modifier = { 
					name = fez_fez 
					duration = -1
				}
			}
		} 
	}
}
ai_fez_branch_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = FEZ
			was_tag = FEZ
		}
	}

	fez_jaysh = {
		icon = per_create_the_ghulams
		position = 1
		provinces_to_highlight = {  } 

		trigger = {  
			army_size_percentage = 1
			manpower_percentage = 0.75
		} 

		effect = {  
			add_country_modifier = { 
				name = fez_army_mod
				duration = 7300
			}
		} 
	}

	fez_mrk = {
		icon = mam_recruit_the_mamluks
		position = 2
		required_missions = { fez_jaysh } 
		provinces_to_highlight = {  
			OR = { 
				area = tamesna_area
				area = western_morocco_area
				owned_by = MRK 
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			OR = { 
				AND = { 
					NOT = { exists = MRK }
					tamesna_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
					western_morocco_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
				}
				MRK = { 
					capital_scope = { controlled_by = ROOT }
				}
			}
		} 

		effect = {  
			custom_tooltip = fez_mrk.tt
			hidden_effect = { 
				if = { 
					limit = { exists = MRK }
					country_event = { id = aetas_mor.14 }
				}
			}
			sus_area = {
				limit = {
					is_city = yes 
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			southern_morocco_area = {
				limit = {
					is_city = yes 
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			add_casus_belli = {
				target = TFL
				type = cb_vassalize_mission
				months = 240
			}
			tafilalt_area = {
				limit = {
					is_city = yes 
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	fez_tfl = {
		icon = spa_reform_tercios
		position = 3
		required_missions = { fez_mrk } 
		provinces_to_highlight = {  
			area = tafilalt_area 
			NOT = { 
				OR = {
					country_or_non_sovereign_subject_holds = ROOT 
					is_city = no 
				}
			}
		} 

		trigger = {  
			tafilalt_area = { 
				OR = { 
					is_city = no 
					country_or_non_sovereign_subject_holds = ROOT 
				}
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = fez_tfl_mod
				duration = 7300
			}
			draa_area = {
				limit = {
					is_city = yes 
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	fez_dra = {
		icon = mission_almanzor
		position = 4
		required_missions = { fez_tfl } 
		provinces_to_highlight = {  
			area = draa_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			draa_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = fez_shurafa
				duration = 18250
			}
		} 
	}
}
ai_fez_branch_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = FEZ
			was_tag = FEZ
		}
	}

	fez_sebtah = {
		icon = mission_retake_ceuta
		position = 2
		required_missions = { fez_jaysh } 
		provinces_to_highlight = {  
			province_id = 1751
			NOT = { 
				AND = { 
					owned_by = ROOT 
					is_core = ROOT 
				}
			}
		} 

		trigger = { owns_core_province = 1751 } 

		effect = {  
			add_country_modifier = { 
				name = fez_ceuta
				duration = -1
			}
		} 
	}

	fez_gib = {
		icon = mission_rb_take_gibraltar
		position = 3
		required_missions = { fez_sebtah } 
		provinces_to_highlight = {  
			province_id = 226
			NOT = {
				AND = { 
					owned_by = ROOT 
					is_core = ROOT 
				}
			}
		} 

		trigger = {  
			owns_core_province = 226
		} 

		effect = {  
			226 = { 
				add_building = fort_15th
				add_province_triggered_modifier = marinid_fort 
			}
			3401 = { add_core = ROOT }
			granada_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	fez_tza = {
		icon = mission_turning_the_tables
		position = 4
		required_missions = { fez_tfl } 
		provinces_to_highlight = {  
			OR = { 
				area = sus_area
				area = southern_morocco_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			sus_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
			southern_morocco_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_stability = 1 
			add_country_modifier = { 
				name = fez_tza_mod
				duration = 7300
			}
		} 
	}
}
ai_dra_branch_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = DRA
			was_tag = DRA
		}
	}

	dra_jaz = {
		icon = mission_sufism
		position = 1
		provinces_to_highlight = { is_capital_of = TZA } 

		trigger = { alliance_with = TZA } 

		effect = {  
			add_country_modifier = { 
				name = dra_tza_friendliness
				duration = 7300
			}
		} 
	}

	dra_tza = {
		icon = per_qizilbash_loyalty
		position = 2
		required_missions = {
			dra_jaz
			dra_sufi
		}
		provinces_to_highlight = {  
			OR = { 
				area = southern_morocco_area
				owned_by = TZA 
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			OR = { 
				TZA = { 
					AND = { 
						has_opinion = { 
							who = ROOT 
							value = 190 
						}
						alliance_with = ROOT 
					}
				}
				southern_morocco_area = { 
					country_or_non_sovereign_subject_holds = ROOT 
					type = all 
				}
			}
		} 

		effect = {  
			custom_tooltip = dra_tza.tt
			hidden_effect = { 
				if = { 
					limit = { 
						NOT = { 
							southern_morocco_area = { 
								country_or_non_sovereign_subject_holds = ROOT 
								type = all 
							}
						}
					}
					country_event = { id = aetas_mor.12 }
				}
			}
			348 = { add_core = ROOT }
			2464 = { add_core = ROOT }
		} 
	}

	dra_sus = {
		icon = mission_friends_or_enemies
		position = 3
		required_missions = { dra_tza } 
		provinces_to_highlight = {  
			area = sus_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			OR = { 
				348 = { controlled_by = ROOT }
				sus_area = { 
					country_or_non_sovereign_subject_holds = ROOT
					type = all 
				}
			}
		} 

		effect = {  
			country_event = { id = aetas_mor.13 }
			tamesna_area = {
				limit = {
					NOT = { is_core = ROOT } 
				}
				add_core = ROOT
			}
			western_morocco_area = {
				limit = {
					NOT = { is_core = ROOT } 
				}
				add_core = ROOT
			}
		} 
	}

	dra_mrk = {
		icon = mission_turning_the_tables
		position = 4
		required_missions = { dra_sus } 
		provinces_to_highlight = {  
			OR = { 
				area = tamesna_area
				area = western_morocco_area 
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT } 
		} 

		trigger = {  
			OR = { 
				344 = { 
					AND = { 
						controlled_by = ROOT 
						is_capital_of = MRK 
					}
				}
				AND = { 
					tamesna_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
					western_morocco_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
				}
			}
		} 

		effect = {  
			custom_tooltip = dra_mrk.tt
			hidden_effect = { 
				if = { 
					limit = { 
						344 = { 
							AND = { 
								controlled_by = ROOT 
								is_capital_of = MRK 
							}
						}
					}
					country_event = { id = aetas_mor.5 }
				}
			}
			marrekesh_area = {
				limit = {
					NOT = { is_core = ROOT } 
				}
				add_core = ROOT
			}
			northern_morocco_area = {
				limit = {
					NOT = { is_core = ROOT } 
				}
				add_core = ROOT
			}
		} 
	}

	dra_fez = {
		icon = mission_gra3
		position = 5
		required_missions = { dra_mrk } 
		provinces_to_highlight = {  
			OR = {
				area = marrekesh_area
				area = northern_morocco_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			OR = { 
				343 = { 
					AND = { 
						controlled_by = ROOT 
						is_capital_of = FEZ 
					}
				}
				AND = { 
					tamesna_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
					western_morocco_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
				}
			}
		} 

		effect = {  
			custom_tooltip = dra_fez.tt
			hidden_effect = { 
				if = { 
					limit = { 
						343 = { 
							AND = { 
								controlled_by = ROOT 
								is_capital_of = FEZ
							}
						}
					}
					country_event = { id = aetas_mor.7 }
				}
			}
		} 
	}
}
ai_dra_branch_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = DRA
			was_tag = DRA
		}
	}

	dra_sufi = {
		icon = mission_quran
		position = 1
		provinces_to_highlight = {  } 

		trigger = {  
			NOT = { piety = -0.5 }
		}  

		effect = {  
			add_country_modifier = { 
				name = dra_sufi_mod
				duration = 7300
			}
		} 
	}

	dra_zawiya = {
		icon = mission_mosque
		position = 2
		required_missions = { dra_sufi } 
		provinces_to_highlight = {  
			owned_by = ROOT 
			NOT = { 
				AND = { 
					num_of_times_improved = 2
					has_tax_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			num_of_owned_provinces_with = { 
				value = 5
				num_of_times_improved = 2
				has_tax_building_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = dra_zawiyas
				duration = -1
			}
		} 
	}

	dra_dra = {
		icon = mission_son_expand_djenne_mosque
		position = 3
		required_missions = { dra_zawiya } 
		provinces_to_highlight = {  
			province_id = 2466
			NOT = {
				AND = { 
					country_or_non_sovereign_subject_holds = ROOT 
					num_of_times_improved = 5
					has_tax_building_trigger = yes 
					has_trade_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			2466 = { 
				country_or_non_sovereign_subject_holds = ROOT 
				num_of_times_improved = 5
				has_tax_building_trigger = yes 
				has_trade_building_trigger = yes 
			}
		} 

		effect = {  
			2466 = { 
				change_culture = ROOT 
				add_province_triggered_modifier = dra_dra_mod #missing loc
			}
		} 
	}

	dra_capital = {
		icon = mission_patronize_art_and_religion
		position = 4
		required_missions = {
			dra_dra
			dra_sus
		}
		provinces_to_highlight = {  
			province_id = 344
			NOT = { 
				AND = { 
					owned_by = ROOT 
					is_core = ROOT 
				}
			}
		} 

		trigger = {  
			owns_core_province = 344
		} 

		effect = { country_event = { id = aetas_mor.6 } } 
	}
}
ai_dra_branch_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = DRA
			was_tag = DRA
		}
	}

	dra_ghazi = {
		icon = mission_ottoman_early_army
		position = 2
		required_missions = { dra_sufi } 
		provinces_to_highlight = {  } 

		trigger = {  
			army_size_percentage = 1
			manpower_percentage = 0.75
		} 

		effect = {  
			add_casus_belli = {
				target = TFL
				type = cb_vassalize_mission
				months = 240
			}
			tafilalt_area = {
				limit = {
					is_city = yes 
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	dra_tfl = {
		icon = mission_deccanis
		position = 3
		required_missions = { dra_ghazi } 
		provinces_to_highlight = {  
			area = tafilalt_area 
			NOT = { 
				OR = { 
					is_city = no 
					country_or_non_sovereign_subject_holds = ROOT
				}
			}
		} 

		trigger = {  
			tafilalt_area = { 
				OR = { 
					country_or_non_sovereign_subject_holds = ROOT 
					is_city = no 
				}
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = sole_sharif
				duration = -1
			}
		} 
	}

	dra_sijilmasa = {
		icon = control_the_means_of_transaction
		position = 4
		required_missions = { dra_tfl } 
		provinces_to_highlight = {  
			province_id = 5752
			NOT = { 
				AND = { 
					country_or_non_sovereign_subject_holds = ROOT 
					num_of_times_improved = 10
					has_trade_building_trigger = yes 
					has_production_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			5752 = { 
				country_or_non_sovereign_subject_holds = ROOT 
				num_of_times_improved = 10
				has_trade_building_trigger = yes 
				has_production_building_trigger = yes 
			}
		} 

		effect = { 5752 = { add_province_triggered_modifier = sijilmasa_mod } } 
	}
}
ai_tfl_branch_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = TFL
			was_tag = TFL
		}
	}

	tfl_sufi = {
		icon = mission_sufism
		position = 1
		provinces_to_highlight = {  } 

		trigger = {  
			NOT = { piety = -0.50 }
		} 

		effect = {  
			add_country_modifier = { 
				name = dra_sufi_mod
				duration = 7300
			}
			add_casus_belli = {
				target = DRA
				type = cb_vassalize_mission
				months = 240
			}
			draa_area = {
				limit = {
					is_city = yes 
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	tfl_dra = {
		icon = mam_persia
		position = 2
		required_missions = { tfl_sufi } 
		provinces_to_highlight = {  
			area = draa_area 
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			draa_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = sole_sharif
				duration = -1 
			}
			southern_morocco_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			sus_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	tfl_sus = {
		icon = mission_friends_or_enemies
		position = 3
		required_missions = { tfl_dra } 
		provinces_to_highlight = {  
			area = sus_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			OR = { 
				348 = { controlled_by = ROOT }
				sus_area = { 
					country_or_non_sovereign_subject_holds = ROOT
					type = all 
				}
			}
		} 

		effect = {  
			country_event = { id = aetas_mor.13 }
			tamesna_area = {
				limit = {
					NOT = { is_core = ROOT } 
				}
				add_core = ROOT
			}
			western_morocco_area = {
				limit = {
					NOT = { is_core = ROOT } 
				}
				add_core = ROOT
			}
		}  
	}

	tfl_mrk = {
		icon = mission_turning_the_tables
		position = 4
		required_missions = { tfl_sus } 
		provinces_to_highlight = {  
			OR = { 
				area = tamesna_area
				area = western_morocco_area 
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT } 
		} 

		trigger = {  
			OR = { 
				344 = { 
					AND = { 
						controlled_by = ROOT 
						is_capital_of = MRK 
					}
				}
				AND = { 
					tamesna_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
					western_morocco_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
				}
			}
		} 

		effect = {  
			custom_tooltip = dra_mrk.tt
			hidden_effect = { 
				if = { 
					limit = { 
						344 = { 
							AND = { 
								controlled_by = ROOT 
								is_capital_of = MRK 
							}
						}
					}
					country_event = { id = aetas_mor.5 }
				}
			}
			marrekesh_area = {
				limit = {
					NOT = { is_core = ROOT } 
				}
				add_core = ROOT
			}
			northern_morocco_area = {
				limit = {
					NOT = { is_core = ROOT } 
				}
				add_core = ROOT
			}
		} 
	}

	tfl_fez = {
		icon = mission_gra3
		position = 5
		required_missions = { tfl_mrk } 
		provinces_to_highlight = {  
			OR = {
				area = marrekesh_area #gharb
				area = northern_morocco_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			OR = { 
				343 = { 
					AND = { 
						controlled_by = ROOT 
						is_capital_of = FEZ 
					}
				}
				AND = { 
					tamesna_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
					western_morocco_area = { 
						country_or_non_sovereign_subject_holds = ROOT 
						type = all 
					}
				}
			}
		} 

		effect = {  
			custom_tooltip = dra_fez.tt
			hidden_effect = { 
				if = { 
					limit = { 
						343 = { 
							AND = { 
								controlled_by = ROOT 
								is_capital_of = FEZ
							}
						}
					}
					country_event = { id = aetas_mor.7 }
				}
			}
		} 
	}
}
ai_tfl_branch_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = TFL
			was_tag = TFL
		}
	}

	tfl_trade = {
		icon = mission_the_grand_bazaar
		position = 1
		provinces_to_highlight = {  
			owned_by = ROOT 
			has_trade_building_trigger = no 
		} 

		trigger = {  
			num_of_owned_provinces_with = { 
				value = 5
				has_trade_building_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = {
				name = tfl_caravans
				duration = 18250
			}
		} 
	}

	tfl_tfl = {
		icon = control_the_means_of_transaction
		position = 2
		required_missions = { tfl_trade } 
		provinces_to_highlight = {  
			province_id = 5752
			NOT = { 
				AND = { 
					country_or_non_sovereign_subject_holds = ROOT 
					num_of_times_improved = 10
					has_trade_building_trigger = yes 
					has_production_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			5752 = { 
				country_or_non_sovereign_subject_holds = ROOT 
				num_of_times_improved = 10
				has_trade_building_trigger = yes 
				has_production_building_trigger = yes 
			}
		} 

		effect = { 5752 = { add_province_triggered_modifier = sijilmasa_mod } } 
	}

	tfl_caravan = {
		icon = mission_traverse_the_sahara
		position = 3
		required_missions = { tfl_tfl } 
		provinces_to_highlight = {  
			province_id = 5752
			NOT = { is_strongest_trade_power = ROOT }
		} 

		trigger = { 5272 = { is_strongest_trade_power = ROOT } } 

		effect = {  
			add_country_modifier = { 
				name = tfl_trade_mod
				duration = -1
			}
		} 
	}

	tfl_cap = {
		icon = mission_patronize_art_and_religion
		position = 4
		required_missions = {
			tfl_caravan
			tfl_sus
		}
		provinces_to_highlight = {  
			province_id = 344
			NOT = { 
				AND = { 
					owned_by = ROOT 
					is_core = ROOT 
				}
			}
		} 

		trigger = {  
			owns_core_province = 344
		} 

		effect = { country_event = { id = aetas_mor.6 } } 
	}
}
ai_mrk_branch_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = MRK
			was_tag = MRK
		}
	}

	mrk_tribes = {
		icon = per_expand_our_influence
		position = 1
		provinces_to_highlight = {  } 

		trigger = {  
			army_size_percentage = 1
			manpower_percentage = 0.75
		} 

		effect = {  
			western_morocco_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			tamesna_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mrk_fez = {
		icon = mission_restore_trade_superiority
		position = 2
		required_missions = { mrk_tribes } 
		provinces_to_highlight = {  
			OR = { 
				area = western_morocco_area 
				area = tamesna_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			western_morocco_area = { 
				country_or_non_sovereign_subject_holds = ROOT
				type = all 
			}
			tamesna_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mrk_defiance
				duration = 7300
			}
			tafilalt_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			sus_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mrk_tfl = {
		icon = mission_raid_on_iceland
		position = 3
		required_missions = { mrk_fez } 
		provinces_to_highlight = {  
			area = tafilalt_area
			NOT = { 
				OR = { 
					is_city = no 
					country_or_non_sovereign_subject_holds = ROOT
				}
			}
		} 

		trigger = {  
			tafilalt_area = { 
				OR = {
					is_city = no 
					country_or_non_sovereign_subject_holds = ROOT 
				}
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = fez_tfl_mod
				duration = 18250
			}
		} 
	}
}
ai_mrk_branch_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = MRK
			was_tag = MRK
		}
	}

	mrk_mrk = {
		icon = mission_alhambra
		position = 1
		provinces_to_highlight = {  
			province_id = 344
			NOT = { 
				AND = { 
					num_of_times_improved = 5
					has_tax_building_trigger = yes 
					has_trade_building_trigger = yes
				}
			}
		} 

		trigger = {  
			344 = { 
				is_capital = yes 
				num_of_times_improved = 5
				has_tax_building_trigger = yes 
				has_trade_building_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mrk_centralizing
				duration = 18250
			}
			344 = { add_province_triggered_modifier = mrk_mrk_mod }
		} 
	}

	mrk_alm = {
		icon = mission_gra7
		position = 3
		required_missions = {
			mrk_fez
			mrk_mrk
		}
		provinces_to_highlight = {  
			OR = { 
				province_id = 344
				province_id = 2468
				province_id = 4568
			}
			NOT = { 
				AND = { 
					owned_by = ROOT 
					is_core = ROOT 
				}
			}
		} 

		trigger = {  
			reform_level = 3
			owns_core_province = 344
			owns_core_province = 2468
			owns_core_province = 4568
		} 

		effect = {  
			country_event = { id = aetas_mor.15 }
			marrekesh_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			northern_morocco_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mrk_north = {
		icon = mission_the_sultan_of_morocco
		position = 4
		required_missions = {
			mrk_alm
			mrk_tfl
		}
		provinces_to_highlight = {  
			OR = { 
				area = marrekesh_area
				area = northern_morocco_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			marrekesh_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
			northern_morocco_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = {
				name = mrk_fez_mod
				duration = -1
			}
		} 
	}
}
ai_mrk_branch_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = MRK
			was_tag = MRK
		}
	}

	mrk_south = {
		icon = mission_conquer_timbuktu
		position = 1
		provinces_to_highlight = {  
			area = sus_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			sus_area = { 
				country_or_non_sovereign_subject_holds = ROOT
				type = all 
			}
		} 

		effect = {  
			southern_morocco_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mrk_tza = {
		icon = mam_recruit_the_mamluks
		position = 2
		required_missions = { mrk_south } 
		provinces_to_highlight = {  
			area = southern_morocco_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT } 
		} 

		trigger = {  
			southern_morocco_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			draa_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mrk_dra = {
		icon = mission_control_the_ganges_delta
		position = 3
		required_missions = { mrk_tza } 
		provinces_to_highlight = {  
			area = draa_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			draa_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_stability = 1 
			add_country_modifier = { 
				name = dra_sufi_mod
				duration = 7300
			}
		} 
	}
}
ai_mor_branch_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = MOR } 

	mor_waj = {
		icon = per_butcher_black_sheep
		position = 6
		required_missions = { mor_army } 
		provinces_to_highlight = {  
			area = tlemcen_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			tlemcen_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_tlc
				duration = 18250
			}
			barbary_coast_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mor_orania = {
		icon = mission_protect_albania
		position = 7
		required_missions = {
			mor_waj
			mor_fij
		}
		provinces_to_highlight = {  
			area = barbary_coast_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			barbary_coast_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			algiers_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			kabylia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			numidia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mor_brb_coast = {
		icon = mission_gra1
		position = 8
		required_missions = { mor_orania } 
		provinces_to_highlight = {  
			OR = { 
				area = algiers_area
				area = kabylia_area 
				area = numidia_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			algiers_area = {
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
			kabylia_area = {
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
			numidia_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_brb_coast_mod
				duration = -1 
			}
			tunisia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mor_tun = {
		icon = mission_patronize_art_and_religion
		position = 9
		required_missions = {
			mor_brb_coast
			mor_tribute
		}
		provinces_to_highlight = {  
			area = tunisia_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			tunisia_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_tun_mod
				duration = -1
			}
			byzancena_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			tripolitania_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}
}
ai_mor_branch_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = MOR } 

	mor_army = {
		icon = mission_subdue_rajputana
		position = 5
		provinces_to_highlight = {  } 

		trigger = {  
			army_size_percentage = 1 
			manpower_percentage = 0.9
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_army_mod
				duration = 7300
			}
			tlemcen_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			hautes_plaines_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mor_fij = {
		icon = mission_dansk_ostindia
		position = 6
		required_missions = { mor_army } 
		provinces_to_highlight = {  
			OR = { 
				province_id = 5759
				province_id = 5784
				province_id = 349
				province_id = 5760
				province_id = 2463
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			5759 = { country_or_non_sovereign_subject_holds = ROOT }
			5784 = { country_or_non_sovereign_subject_holds = ROOT }
			349 = { country_or_non_sovereign_subject_holds = ROOT }
			5760 = { country_or_non_sovereign_subject_holds = ROOT }
			2463 = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		effect = {  
			349 = { 
				add_core = ROOT 
				change_culture = ROOT 
				center_of_trade = 1 
			}
			north_saharan_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			ouled_nail_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			if = { 
				limit = { exists = LGH }
				add_casus_belli = {
					target = LGH 
					type = cb_force_tributary_mission
					months = 400
				}
			}
			if = { 
				limit = { exists = MZB }
				add_casus_belli = {
					target = MZB
					type = cb_force_tributary_mission
					months = 400
				}
			}
			if = { 
				limit = { exists = CAA }
				add_casus_belli = {
					target = CAA
					type = cb_force_tributary_mission
					months = 400
				}
			}
			if = { 
				limit = { exists = OGL }
				add_casus_belli = {
					target = OGL 
					type = cb_force_tributary_mission
					months = 400
				}
			}
		} 
	}

	mor_tribute = {
		icon = mission_pacify_the_berbers
		position = 8
		required_missions = { mor_orania } 
		provinces_to_highlight = {  
			OR = { 
				area = north_saharan_area
				area = ouled_nail_area
			}
			NOT = { 
				OR = { 
					country_or_non_sovereign_subject_holds = ROOT 
					owner = { is_subject_of = ROOT }
				}
			}
		} 

		trigger = {  
			north_saharan_area = { 
				OR = { 
					country_or_non_sovereign_subject_holds = ROOT 
					owner = { is_subject_of = ROOT }
				}
				type = all 
			}
			ouled_nail_area = { 
				OR = { 
					country_or_non_sovereign_subject_holds = ROOT 
					owner = { is_subject_of = ROOT }
				}
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_tribs_mod
				duration = -1 
			}
		} 
	}
}
ai_mor_branch_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = MOR } 

	mor_tuat = {
		icon = mission_saharan_route
		position = 6
		required_missions = { mor_army } 
		provinces_to_highlight = {  
			OR = { 
				province_id = 5749
				province_id = 2460
				province_id = 5753
				province_id = 1127
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			OR = { 
				AND = { 
					5749 = { country_or_non_sovereign_subject_holds = ROOT }
					2460 = { country_or_non_sovereign_subject_holds = ROOT }
					5753 = { country_or_non_sovereign_subject_holds = ROOT }
					1127 = { country_or_non_sovereign_subject_holds = ROOT }
				}
				AND = { 
					manpower = 8
					mil_power = 80
					adm_power = 40
				}
			}
		} 

		effect = {  
			if = {
				limit = { 
					5749 = { is_city = no }
				}
				add_manpower = -2
				add_mil_power = -20 
				add_adm_power = -10
				5749 = { 
					cede_province = ROOT 
					add_core = ROOT 
				}
			}
			if = {
				limit = { 
					2460 = { is_city = no }
				}
				add_manpower = -2
				add_mil_power = -20 
				add_adm_power = -10
				2460 = { 
					cede_province = ROOT 
					add_core = ROOT 
				}
			}
			if = {
				limit = { 
					5753 = { is_city = no }
				}
				add_manpower = -2
				add_mil_power = -20 
				add_adm_power = -10
				5753 = { 
					cede_province = ROOT 
					add_core = ROOT 
				}
			}
			if = {
				limit = { 
					1127 = { is_city = no }
				}
				add_manpower = -2
				add_mil_power = -20 
				add_adm_power = -10
				1127 = { 
					discover_country = ROOT 
					cede_province = ROOT 
					add_core = ROOT 
				}
			}
			western_sahara_area = { 
				discover_country = ROOT 
			}
			baghena_area = { discover_country = ROOT }
			niger_bend_area = { discover_country = ROOT }
			if = { 
				limit = { exists = TMB }
				add_casus_belli = {
					target = TMB
					type = cb_vassalize_mission
					months = 400
				}
			}
			else = { 
				1128 = { add_permanent_claim = ROOT }
				1129 = { add_permanent_claim = ROOT }
				1132 = { add_permanent_claim = ROOT }
				2247 = { add_permanent_claim = ROOT }
				2260 = { add_permanent_claim = ROOT }
				2246 = { add_permanent_claim = ROOT }
			}
		} 
	}

	mor_tmb = {
		icon = per_create_the_tupchi
		position = 7
		required_missions = { mor_tuat } 
		provinces_to_highlight = {  
			province_id = 1132
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			1132 = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_tmb_trade 
				duration = -1 
			}

			custom_tooltip = mor_tmb.tt
			hidden_effect = { 
				if = { 
					limit = { TMB = { is_subject_of = ROOT } }
					add_country_modifier = { 
						name = mor_tmb_mod
						duration = -1 
					}
				}
			}
			if = { 
				limit = { TMB = { is_subject_of = ROOT } }
				baghena_area = {
					limit = {
						NOT = { is_core = TMB } 
					}
					add_core = TMB 
				}
			}
			else = { 
				baghena_area = {
					limit = {
						NOT = { is_permanent_claim = ROOT } 
						NOT = { is_core = ROOT } 
					}
					add_permanent_claim = ROOT
				}
			}
			if = { 
				limit = { TMB = { is_subject_of = ROOT } }
				niger_bend_area = {
					limit = {
						NOT = { is_core = TMB } 
					}
					add_core = TMB 
				}
			}
			else = { 
				niger_bend_area = {
					limit = {
						NOT = { is_permanent_claim = ROOT } 
						NOT = { is_core = ROOT } 
					}
					add_permanent_claim = ROOT
				}
			}
			niger_region = { 
				limit = { NOT = { has_discovered = ROOT } }
				discover_country = ROOT 
			}
			sahel_region = { 
				limit = { NOT = { has_discovered = ROOT } }
				discover_country = ROOT 
			}
		} 
	}

	mor_son = {
		icon = mission_the_songhai_campaign
		position = 8
		required_missions = { mor_tmb } 
		provinces_to_highlight = {  
			area = niger_bend_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			niger_bend_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_sudan
				duration = -1 
			}
			jenne_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			dendi_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			massina_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mor_carib = {
		icon = mission_colonize_the_west
		position = 9
		required_missions = { mor_west } 
		provinces_to_highlight = {  
			colonial_region = colonial_the_carribean
			NOT = {  
				OR = { 
					is_city = yes 
					country_or_non_sovereign_subject_holds = ROOT 
				}
			}
		} 

		trigger = {  
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { 
				value = 5 
				colonial_region = colonial_the_carribean
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = qarib_mod
				duration = -1
			}
		} 
	}
}
ai_mor_branch_4a = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { 
		OR = { 
			primary_culture = moroccan 
			primary_culture = atlasic
			primary_culture = riffian 
			primary_culture = shilha
		}
	} 

	unite_morocco = {
		icon = yem_dawah
		position = 1
		provinces_to_highlight = {  
			OR = { 
				province_id = 343
				province_id = 2467
				province_id = 342
				province_id = 344
				province_id = 5738
				province_id = 2466
				province_id = 5752
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { 
				value = 5
				OR = { 
					province_id = 343
					province_id = 2467
					province_id = 342
					province_id = 344
					province_id = 5738
					province_id = 2466
					province_id = 5752
				}
			}
			num_of_owned_provinces_with = { 
				culture = moroccan 
				value = 10
			}
		} 

		effect = {  
			change_tag = MOR
			if = { 
				limit = { 
					NOT = { government_rank = 2 }
				}
				set_government_rank = 2 
			} 
			if = { 
				limit = { NOT = { government = monarchy } }
				change_government = monarchy 
			}
			if = { 
				limit = { NOT = { has_reform = shurafa_reform } }
				add_government_reform = moroccan_sultanate_reform
			}
			hidden_effect = { 
				every_subject_country = { 
					random_list = { 
						1 = { change_country_color = { color = { 227  60  30 } } }
						1 = { change_country_color = { color = { 187  20  10 } } }
						1 = { change_country_color = { color = { 177  40  20 } } }
						1 = { change_country_color = { color = { 197  80  50 } } }
					}
				}
			}
			if = {
				limit = {
					NOT = { has_idea_group = ai_MOR_ideas }
				}
				country_event = { id = ideagroups.1 } #Swap Ideas
			}
			swap_non_generic_missions = yes 
			northern_morocco_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			rif_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			marrekesh_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			tamesna_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			western_morocco_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			tafilalt_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			sus_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			draa_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			southern_morocco_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}
}
ai_mor_branch_4a1 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = MOR } 

	mor_capitals = {
		icon = mission_new_world_power
		position = 2
		required_missions = { unite_morocco } 
		provinces_to_highlight = {  
			OR = { 
				province_id = 344
				province_id = 342
				province_id = 2467
				province_id = 343
			}
			NOT = { 
				AND = { 
					owned_by = ROOT
					is_core = ROOT 
				}
			}
		} 

		trigger = {  
			owns_core_province = 344
			owns_core_province = 342
			owns_core_province = 2467
			owns_core_province = 343
		} 

		effect = { country_event = { id = aetas_mor.16 } } 
	}
}
ai_mor_fez_branch_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = MOR
		has_country_flag = mor_fas_flag
	}

	mor_fez_capital = {
		icon = mission_gra6
		position = 3
		required_missions = { mor_capitals } 
		provinces_to_highlight = {  
			province_id = 343
			NOT = { 
				AND = { 
					is_capital_of = ROOT 
					num_of_times_improved = 15 
					has_tax_building_trigger = yes 
					has_trade_building_trigger = yes 
					has_production_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			343 = { 
				is_capital_of = ROOT 
				num_of_times_improved = 15 
				has_tax_building_trigger = yes 
				has_trade_building_trigger = yes 
				has_production_building_trigger = yes 
			}
		} 

		effect = { 343 = { add_province_triggered_modifier = mor_fas_mod } } 
	}

	mor_dev1 = {
		icon = mission_develop_cordoba
		position = 4
		required_missions = { mor_fez_capital } 
		provinces_to_highlight = {  
			owned_by = ROOT 
			NOT = { 
				AND = { 
					num_of_times_improved = 4
					has_manufactory_trigger = yes 
				}
			}
		} 

		trigger = {  
			num_of_owned_provinces_with = { 
				value = 15 
				num_of_times_improved = 4
				has_manufactory_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_dev_mod
				duration = -1
			}
		} 
	}
}
ai_mor_marrakesh_branch_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = MOR
		has_country_flag = mor_marrakesh_flag
	}

	mor_marrakesh_capital = {
		icon = mission_el_badi_palace
		position = 3
		required_missions = { mor_capitals } 
		provinces_to_highlight = {  
			province_id = 344
			NOT = { 
				AND = { 
					is_capital_of = ROOT 
					num_of_times_improved = 15 
					has_tax_building_trigger = yes 
					has_trade_building_trigger = yes 
					has_production_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			344 = { 
				is_capital_of = ROOT 
				num_of_times_improved = 15 
				has_tax_building_trigger = yes 
				has_trade_building_trigger = yes 
				has_production_building_trigger = yes 
			}
		} 

		effect = { 344 = { add_province_triggered_modifier = mor_murrakesh_mod } } 
	}

	mor_dev2 = {
		icon = mission_develop_cordoba
		position = 4
		required_missions = { mor_marrakesh_capital } 
		provinces_to_highlight = {  
			owned_by = ROOT 
			NOT = { 
				AND = { 
					num_of_times_improved = 4
					has_manufactory_trigger = yes 
				}
			}
		} 

		trigger = {  
			num_of_owned_provinces_with = { 
				value = 15 
				num_of_times_improved = 4
				has_manufactory_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_dev_mod
				duration = -1
			}
		} 
	}
}
ai_mor_ribat_branch_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = MOR
		has_country_flag = mor_ribat_flag
	}

	mor_ribat_capital = {
		icon = mission_imperial_cities
		position = 3
		required_missions = { mor_capitals } 
		provinces_to_highlight = {  
			province_id = 342
			NOT = { 
				AND = { 
					is_capital_of = ROOT 
					num_of_times_improved = 15 
					has_tax_building_trigger = yes 
					has_trade_building_trigger = yes 
					has_production_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			342 = { 
				is_capital_of = ROOT 
				num_of_times_improved = 15 
				has_tax_building_trigger = yes 
				has_trade_building_trigger = yes 
				has_production_building_trigger = yes 
			}
		} 

		effect = { 342 = { add_province_triggered_modifier = mor_ribat_mod } } 
	}

	mor_dev3 = {
		icon = mission_develop_cordoba
		position = 4
		required_missions = { mor_ribat_capital } 
		provinces_to_highlight = {  
			owned_by = ROOT 
			NOT = { 
				AND = { 
					num_of_times_improved = 4
					has_manufactory_trigger = yes 
				}
			}
		} 

		trigger = {  
			num_of_owned_provinces_with = { 
				value = 15 
				num_of_times_improved = 4
				has_manufactory_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_dev_mod
				duration = -1
			}
		} 
	}
}
ai_mor_meknes_branch_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = MOR
		has_country_flag = mor_meknes_flag
	}

	mor_meknes = {
		icon = unify_piedmont
		position = 3
		required_missions = { mor_capitals } 
		provinces_to_highlight = {  
			province_id = 2467
			NOT = { 
				AND = { 
					is_capital_of = ROOT 
					num_of_times_improved = 15 
					has_tax_building_trigger = yes 
					has_trade_building_trigger = yes 
					has_production_building_trigger = yes 
				}
			}
		} 

		trigger = {  
			2467 = { 
				is_capital_of = ROOT 
				num_of_times_improved = 15 
				has_tax_building_trigger = yes 
				has_trade_building_trigger = yes 
				has_production_building_trigger = yes 
			}
		} 

		effect = { 2467 = { add_province_triggered_modifier = mor_murrakesh_mod } } 
	}

	mor_dev4 = {
		icon = mission_develop_cordoba
		position = 4
		required_missions = { mor_meknes } 
		provinces_to_highlight = {  
			owned_by = ROOT 
			NOT = { 
				AND = { 
					num_of_times_improved = 4
					has_manufactory_trigger = yes 
				}
			}
		} 

		trigger = {  
			num_of_owned_provinces_with = { 
				value = 15 
				num_of_times_improved = 4
				has_manufactory_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_dev_mod
				duration = -1
			}
		} 
	}
}
ai_mor_branching_branch_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = MOR
		NOT = {
			OR = {
				has_country_flag = mor_fas_flag
				has_country_flag = mor_ribat_flag
				has_country_flag = mor_marrakesh_flag
				has_country_flag = mor_meknes_flag #nonexisting modifier :((
			}
		}
	}

	mor_branching_cap = {
		icon = mission_unknown_mission
		position = 3
		required_missions = { mor_capitals } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_caps.tt
				always = no 
			}
		} 

		effect = { custom_tooltip = mor_caps.tt } 
	}

	mor_dev = {
		icon = mission_develop_cordoba
		position = 4
		required_missions = { mor_branching_cap } 
		provinces_to_highlight = {  
			owned_by = ROOT 
			NOT = { 
				AND = { 
					num_of_times_improved = 4
					has_manufactory_trigger = yes 
				}
			}
		} 

		trigger = {  
			num_of_owned_provinces_with = { 
				value = 15 
				num_of_times_improved = 4
				has_manufactory_trigger = yes 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_dev_mod
				duration = -1
			}
		} 
	}
}
ai_mor_branch_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = MOR } 

	mor_navy = {
		icon = mission_gujarati_diaspora
		position = 5
		provinces_to_highlight = {  } 

		trigger = {  
			4563 = { 
				owned_by = ROOT 
				is_core = ROOT 
				num_of_times_improved = 5
			}
		} 

		effect = {  
			4563 = { 
				add_province_triggered_modifier = mor_royal_shipyard 
				add_building = shipyard
			}
		} 
	}

	mor_expel = {
		icon = spa_spanish_road
		position = 6
		required_missions = { mor_navy } 
		provinces_to_highlight = {  
			OR = { 
				area = northern_morocco_area
				area = marrekesh_area
				area = tamesna_area
				area = western_morocco_area
				area = sus_area
				area = southern_morocco_area
			}
			owner = { religion_group = christian }
		} 

		trigger = {  
			all_province = { 
				OR = { 
					area = northern_morocco_area
					area = marrekesh_area
					area = tamesna_area
					area = western_morocco_area
					area = sus_area
					area = southern_morocco_area
				}
				NOT = { owner = { religion_group = christian } }
			}
		} 

		effect = {  
			add_prestige = 15
			if = { 
				limit = { NOT = { 226 = { is_core = ROOT } } }
				226 = { add_core = ROOT }
			}
			granada_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mor_gra = {
		icon = mission_andalusi_arches
		position = 7
		required_missions = {
			mor_expel
			mor_corsairs
		}
		provinces_to_highlight = {  
			area = granada_area 
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = {  
			granada_area = { 
				country_or_non_sovereign_subject_holds = ROOT 
				type = all 
			}
		} 

		effect = {  
			granada_area = { 
				change_culture = andalusi 
				change_religion = sunni 
				add_base_tax = 1
			}
			add_country_modifier = { 
				name = mor_jihad
				duration = -1 
			}
			lower_andalucia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			upper_andalucia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}

	mor_west = {
		icon = mission_raid_christian_trade
		position = 8
		required_missions = { mor_explore } 
		provinces_to_highlight = {  } 

		trigger = {  
			any_province = { 
				OR = {
					superregion = north_america_superregion
					superregion = south_america_superregion
				}
				has_discovered = ROOT 
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = gra_west_mod
				duration = 7300
			}
		} 
	}

	mor_privateers = {
		icon = mission_raid_on_venice
		position = 9
		required_missions = { mor_west } 
		provinces_to_highlight = {  } 

		trigger = {  
			OR = { 
				1529 = { 
					privateer_power = { 
						country = ROOT 
						share = 25
					}
				}
				1531 = { 
					privateer_power = { 
						country = ROOT 
						share = 25
					}
				}
			}
			1515 = { 
				privateer_power = { 
					country = ROOT 
					share = 25
				}
			}
			OR = { 
				1500 = { 
					privateer_power = { 
						country = ROOT 
						share = 25
					}
				}
				1490 = { 
					privateer_power = { 
						country = ROOT 
						share = 25
					}
				}
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_privateer_mod
				duration = -1
			}
		} 
	}
}
ai_mor_branch_5a = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = MOR } 

	mor_tribes = {
		icon = mam_arabia
		position = 2
		required_missions = { unite_morocco } 
		provinces_to_highlight = {  } 

		trigger = {  
			estate_loyalty = { 
				estate = estate_nomadic_tribes 
				loyalty = 70
			}
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_tribes_mod
				duration = 18250
			}
		} 
	}

	mor_absolutism = {
		icon = mission_moor
		position = 3
		required_missions = {
			mor_capitals
			mor_tribes
		}
		provinces_to_highlight = {  } 

		trigger = {  
			reform_level = 10 
			government = monarchy 
			if = { 
				limit = { 
					OR = { 
						was_tag = DRA 
						was_tag = TFL 
					}
				}
				has_reform = shurafa_reform
			}
			else = { 
				has_reform = moroccan_sultanate_reform
			}
		} 

		effect = {  
			if = { 
				limit = { has_reform = shurafa_reform }
				add_government_reform = moroccan_absolutism_reform
			}
			else = { add_government_reform = moroccan_absolutism2_reform }
		} 
	}
}
ai_mor_branch_5 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = MOR } 

	mor_corsairs = {
		icon = mission_corsairs_of_the_north_sea
		position = 6
		required_missions = { mor_navy } 
		provinces_to_highlight = {  } 

		trigger = {  
			navy_size_percentage = 0.9
			navy_tradition = 25
		} 

		effect = {  
			add_country_modifier = { 
				name = mor_navy_mod
				duration = 18250
			}
		} 
	}

	mor_explore = {
		icon = mission_sponsor_piracy
		position = 7
		required_missions = { mor_corsairs } 
		provinces_to_highlight = {  } 

		trigger = { num_of_explorers = 1 } 

		effect = {  
			add_country_modifier = { 
				name = gra_exp_mod
				duration = 7300
			}
		} 
	}

	mor_ports = {
		icon = mission_west_african_ports
		position = 8
		required_missions = { mor_explore } 
		provinces_to_highlight = {  
			region = guinea_region
			has_port = yes 
			NOT = { 
				OR = { 
					is_city = yes 
					country_or_non_sovereign_subject_holds = ROOT 
				}
			}
		} 

		trigger = {  
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { 
				value = 3 
				region = guinea_region
				has_port = yes 
			}
		} 

		effect = {  
			custom_tooltip = gra_guinea.tt
			hidden_effect = { 
				random_owned_province = { 
					limit = {  
						region = guinea_region
						has_port = yes 
					}
					change_trade_goods = gold 
				}
			}
			1201 = { add_permanent_claim = ROOT }
		} 
	}

	mor_zanzibar = {
		icon = mission_portuguese_oman
		position = 9
		required_missions = { mor_ports } 
		provinces_to_highlight = {  
			province_id = 1201
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		} 

		trigger = { owns = 1201 } 

		effect = {  
			1201 = { 
				add_core = ROOT 
				change_culture = ROOT 
				change_religion = ROOT 
				change_trade_goods = cloves
			}
			central_swahili_coast_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
		} 
	}
}
ai_mor_locked_branch_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { 
		OR = { 
			primary_culture = moroccan 
			primary_culture = atlasic 
			primary_culture = riffian 
			primary_culture = shilha
		}
		NOT = { tag = MOR }
	} 

	mor_locked_1b = {
		icon = mission_locked_mission
		position = 6
		required_missions = { mor_locked_2a } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_1c = {
		icon = mission_locked_mission
		position = 7
		required_missions = {
			mor_locked_1b
			mor_locked_2b
		}
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_1d = {
		icon = mission_locked_mission
		position = 8
		required_missions = { mor_locked_1c } 
		provinces_to_highlight = {  } 
		
		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_1e = {
		icon = mission_locked_mission
		position = 9
		required_missions = {
			mor_locked_1d
			mor_locked_2d
		}
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}
}
ai_mor_locked_branch_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { 
		OR = { 
			primary_culture = moroccan 
			primary_culture = atlasic 
			primary_culture = riffian 
			primary_culture = shilha
		}
		NOT = { tag = MOR }
	}

	mor_locked_2a = {
		icon = mission_locked_mission
		position = 5
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_2b = {
		icon = mission_locked_mission
		position = 6
		required_missions = { mor_locked_2a } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_2d = {
		icon = mission_locked_mission
		position = 8
		required_missions = { mor_locked_1c } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}
}
ai_mor_locked_branch_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { 
		OR = { 
			primary_culture = moroccan 
			primary_culture = atlasic 
			primary_culture = riffian 
			primary_culture = shilha
		}
		NOT = { tag = MOR }
	}

	mor_locked_3b = {
		icon = mission_locked_mission
		position = 6
		required_missions = { mor_locked_2a } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_3c = {
		icon = mission_locked_mission
		position = 7
		required_missions = { mor_locked_3b } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_3d = {
		icon = mission_locked_mission
		position = 8
		required_missions = { mor_locked_3c } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_3e = {
		icon = mission_locked_mission
		position = 9
		required_missions = { mor_locked_4d } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}
}
ai_mor_locked_branch_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { 
		OR = { 
			primary_culture = moroccan 
			primary_culture = atlasic 
			primary_culture = riffian 
			primary_culture = shilha
		}
		NOT = { tag = MOR }
	}

	mor_locked_14a = {
		icon = mission_locked_mission
		position = 2
		required_missions = { unite_morocco } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_14b = {
		icon = mission_locked_mission
		position = 3
		required_missions = { mor_locked_14a } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_14c = {
		icon = mission_locked_mission
		position = 4
		required_missions = { mor_locked_14b } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_4a = {
		icon = mission_locked_mission
		position = 5
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_4b = {
		icon = mission_locked_mission
		position = 6
		required_missions = { mor_locked_4a } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_4c = {
		icon = mission_locked_mission
		position = 7
		required_missions = {
			mor_locked_4b
			mor_locked_5b
		}
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_4d = {
		icon = mission_locked_mission
		position = 8
		required_missions = { mor_locked_5c } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_4e = {
		icon = mission_locked_mission
		position = 9
		required_missions = { mor_locked_4d } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}
}
ai_mor_locked_branch_5 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { 
		OR = { 
			primary_culture = moroccan 
			primary_culture = atlasic 
			primary_culture = riffian 
			primary_culture = shilha
		}
		NOT = { tag = MOR }
	}

	mor_locked_15a = {
		icon = mission_locked_mission
		position = 2
		required_missions = { unite_morocco } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	more_locked_15b = {
		icon = mission_locked_mission
		position = 3
		required_missions = {
			mor_locked_14a
			mor_locked_15a
		}
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_5b = {
		icon = mission_locked_mission
		position = 6
		required_missions = { mor_locked_4a } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_5c = {
		icon = mission_locked_mission
		position = 7
		required_missions = { mor_locked_5b } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_5d = {
		icon = mission_locked_mission
		position = 8
		required_missions = { mor_locked_5c } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}

	mor_locked_5e = {
		icon = mission_locked_mission
		position = 9
		required_missions = { mor_locked_5d } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = { 
				tooltip = mor_locked.tt
				always = no 
			}
		} 

		effect = {  
			custom_tooltip = mor_locked.tt
		} 
	}
}
